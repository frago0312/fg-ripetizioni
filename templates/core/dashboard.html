{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-0">Ciao, {{ user.first_name|default:user.username }}!</h2>
        <p class="text-secondary mb-0">Ecco il riepilogo delle tue lezioni.</p>
    </div>
    <div class="d-none d-md-block">
        <span class="badge bg-body-secondary text-body border px-3 py-2 rounded-pill">
            <i class="bi bi-calendar-check me-1"></i> Studente
        </span>
    </div>
</div>

<div class="row g-4">
    <!-- Colonna Sinistra: Stato Pagamenti e Azioni -->
    <div class="col-lg-4">
        <!-- Card Pagamento -->
        <div class="card mb-4 border-0 position-relative overflow-hidden text-white"
             style="background: {% if da_pagare > 0 %}linear-gradient(135deg, #ef4444 0%, #b91c1c 100%){% else %}linear-gradient(135deg, #10b981 0%, #059669 100%){% endif %};">

            <div class="card-body p-4 text-center position-relative z-1">
                <h6 class="text-uppercase fw-bold opacity-75 mb-2">Totale da Saldare</h6>
                <h1 class="display-4 fw-bold mb-0">€ {{ da_pagare|floatformat:2 }}</h1>

                {% if da_pagare > 0 %}
                    <p class="mt-2 opacity-90 small">Per le lezioni già svolte o confermate.</p>
                {% else %}
                    <div class="mt-3">
                        <span class="badge bg-white text-success px-3 py-2 rounded-pill shadow-sm">
                            <i class="bi bi-check-lg"></i> In pari
                        </span>
                    </div>
                {% endif %}
            </div>
            <!-- Decorative circle -->
            <i class="bi {% if da_pagare > 0 %}bi-wallet2{% else %}bi-stars{% endif %} position-absolute"
               style="font-size: 10rem; opacity: 0.1; right: -20px; bottom: -40px;"></i>
        </div>

        <!-- Azioni Rapide -->
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <h6 class="fw-bold text-secondary mb-3 text-uppercase small">Azioni Rapide</h6>
                <div class="d-grid gap-3">
                    <a href="{% url 'prenota' %}" class="btn btn-primary py-3 d-flex align-items-center justify-content-center gap-2 shadow-sm">
                        <i class="bi bi-plus-lg"></i> Prenota Nuova Lezione
                    </a>
                    <a href="{% url 'profilo' %}" class="btn btn-outline-secondary py-2">
                        <i class="bi bi-person-gear me-2"></i> Aggiorna Profilo
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Colonna Destra: Lista Lezioni -->
    <div class="col-lg-8">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold"><i class="bi bi-journal-bookmark me-2 text-primary"></i> Le tue Lezioni</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-body-secondary text-secondary small text-uppercase">
                            <tr>
                                <th class="ps-4">Data & Ora</th>
                                <th>Luogo</th>
                                <th>Prezzo</th>
                                <th class="text-end pe-4">Stato</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lezione in lezioni %}
                            <tr>
                                <td class="ps-4">
                                    <div class="fw-bold">{{ lezione.data_inizio|date:"d M Y" }}</div>
                                    <div class="small text-secondary">{{ lezione.data_inizio|date:"H:i" }} ({{ lezione.durata_ore }}h)</div>
                                </td>
                                <td>
                                    <span class="d-inline-flex align-items-center gap-1">
                                        <i class="bi bi-geo-alt text-muted"></i> {{ lezione.get_luogo_display }}
                                    </span>
                                </td>
                                <td class="fw-medium">€ {{ lezione.prezzo }}</td>
                                <td class="text-end pe-4">
                                    {% if lezione.pagata %}
                                        <span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill">
                                            <i class="bi bi-check-circle-fill"></i> Pagata
                                        </span>
                                    {% else %}
                                        {% if lezione.stato == 'CONFERMATA' %}
                                            <span class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill">Da Pagare</span>
                                        {% elif lezione.stato == 'RIFIUTATA' %}
                                            <span class="badge bg-secondary-subtle text-secondary rounded-pill">Rifiutata</span>
                                        {% else %}
                                            <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle rounded-pill">In attesa</span>
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-5">
                                    <div class="text-muted mb-3"><i class="bi bi-calendar-x fs-1 opacity-50"></i></div>
                                    <h6 class="fw-bold text-secondary">Nessuna lezione trovata</h6>
                                    <p class="small text-muted">Prenota la tua prima ripetizione per vederla qui.</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}